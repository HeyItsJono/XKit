{"id":"soft_refresh","script":"//* TITLE Soft Refresh **//\n//* VERSION 0.5.4 **//\n//* DESCRIPTION Refresh without refreshing **//\n//* DEVELOPER STUDIOXENIX **//\n//* DETAILS This extension allows you to see new posts on your dashboard without refreshing the page. When you get the New Posts bubble, click on the Tumblr logo, and new posts will appear on your dashboard.<br><br>If you still want to refresh the page completely (perform a Hard Refresh), hold the ALT key while clicking on logo and the page will refresh.<br><br>Please note that this extension is highly experimental, and might not work properly all the time. **//\n//* FRAME false **//\n//* BETA false **//\n//* SLOW true **//\n\nXKit.extensions.soft_refresh = new Object({\n\n\trunning: false,\n\tslow: true,\n\tloading: false,\n\tdefault_page_title: document.title,\n        preferences: {\n\t\t\"use_logo\":{\n\t\t\ttext:\"Soft refresh when the tumblr logo is clicked.\",\n\t\t\tdefault:true,\n\t\t\tvalue:true\n\t\t},\n\t\t\"use_home_button\":{\n\t\t\ttext:\"Soft refresh when the home button is clicked.\",\n\t\t\tdefault:true,\n\t\t\tvalue:true\n\t\t},\n\t\t\"show_notifications\":{\n\t\t\ttext:\"Show refresh result notifications\",\n\t\t\tdefault:true,\n\t\t\tvalue:true\n\t\t}\n\t},\n\n\n\trun: function() {\n\t\tthis.running = true;\n\n\t\tXKit.tools.init_css(\"soft_refresh\");\n\t\tif (!XKit.interface.where().dashboard) {\n\t\t\t// Not in dashboard, quit.\n\t\t\treturn;\n\t\t}\n\n\t\t$(\".logo_anchor\").attr('data-old-href', $(\".logo_anchor\").attr('href'));\n\t\tif (this.preferences.use_logo.value) {\n\t\t\t$(\".logo_anchor\").attr('onclick','return false');\n\t\t\t$(\".logo_anchor\").attr('href', '#');\n\t\t\t$(document).on(\"click\", \".logo_anchor\", XKit.extensions.soft_refresh.logo_clicked);\n\t\t}\n\n\t\t$(\"#home_button a\").attr('data-old-href', $(\"#home_button a\").attr('href'));\n\t\tif (this.preferences.use_home_button.value) {\n\t\t\t$(document).on(\"click\", \"#home_button\", XKit.extensions.soft_refresh.logo_clicked);\n\t\t\t// Need to change all children to make sure the user doesn't click the new posts count number.\n\t\t\t$(\"#home_button\").children().attr('href','#');\n\t\t}\n\n\t\tXKit.extensions.soft_refresh.do_post_ids();\n\n\t},\n\n\tdo_post_ids: function() {\n\n\t\t$(\".posts .post\").each(function() {\n\n\t\t\t$(this).parent().attr('data-xkit-post-id', $(this).attr('data-post-id'));\n\n\t\t});\n\n\t},\n\n\tlogo_clicked: function(event) {\n\n\t\tif (event.altKey) {\n\t\t\tlocation.reload(true);\n\t\t\treturn;\n\t\t}\n\t\tXKit.extensions.soft_refresh.load_posts();\n\n\t},\n\n\tload_posts: function() {\n\n\t\tif (typeof XKit.extensions.filter_by_type !== \"undefined\") {\n\t\t\tif (XKit.extensions.filter_by_type.running === true) {\n\t\t\t\tif (XKit.extensions.filter_by_type.current_filter !== \"0\") {\n\t\t\t\t\tlocation.reload(true);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (this.loading === true) { return; }\n\t\tthis.loading = true;\n\n\t\t$(\"#new_post\").after(\"<div id=\\\"xkit_soft_refresh\\\">Checking for new posts</div>\");\n\t\t$(\"#xkit_soft_refresh\").slideDown('fast');\n\n\t\tdocument.title = this.default_page_title;\n\t\t$(\"#new_post_notice_container\").css(\"display\",\"none\");\n\t\t$(\"#new_post_notice_container .tab_notice_value\").html(\"0\");\n\n\t\tfunction soft_refresh_hit_triggers() {\n\n\t\t\tif (typeof Tumblr === \"undefined\") {\n\t\t\t\twindow.top.Tumblr.Events.trigger(\"posts:load\");\n\t\t\t\twindow.top.Tumblr.AudioPlayer.update_all();\n\t\t\t\twindow.top.Tumblr.Events.trigger(\"DOMEventor:updateRect\");\n\t\t\t} else {\n\t\t\t\tTumblr.Events.trigger(\"posts:load\");\n\t\t\t\tTumblr.AudioPlayer.update_all();\n\t\t\t\tTumblr.Events.trigger(\"DOMEventor:updateRect\");\n\t\t\t}\n\n\t\t}\n\n\t\tGM_xmlhttpRequest({\n\t\t\tmethod: \"GET\",\n\t\t\turl: \"http://www.tumblr.com/dashboard/\",\n\t\t\tonerror: function(response) {\n\t\t\t\t$(\"#xkit_soft_refresh\").slideUp('fast', function(){ $(this).remove(); });\n\t\t\t\tXKit.extensions.soft_refresh.show_cant_load_error();\n\t\t\t\tXKit.extensions.soft_refresh.loading = false;\n\t\t\t},\n\t\t\tonload: function(response) {\n\t\t\t\t$(\"#xkit_soft_refresh\").slideUp('fast', function(){ $(this).remove(); });\n\t\t\t\tvar resText = response.responseText;\n\t\t\t\t// Fixes the add_to_image_queue bug that causes this addon to stop working.\n\t\t\t\t// Problem is that the response code wants to call a page embedded function\n\t\t\t\tresText = resText.replace(/add_to_image_queue\\(\\'.*\\'\\)\\;/g, \"\");\n\t\t\t\tvar new_posts = $(\"ol#posts\", resText).html();\n\n\t\t\t\tvar m_count = 0;\n\t\t\t\t$($(\"ol#posts .post\", resText).get().reverse()).each(function() {\n\n\t\t\t\t\tif ($(this).attr('id') == \"new_post_buttons\" || typeof $(this).attr('data-post-id') == \"undefined\")\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tconsole.log(\"post ID = \" + $(this).attr('data-post-id'));\n\t\t\t\t\tvar exists = $(\"[data-post-id='\" + $(this).attr('data-post-id') + \"']\").length > 0;\n\t\t\t\t\texists = exists || $(\"[data-xkit-post-id='\" + $(this).attr('data-post-id') + \"']\").length > 0;\n\t\t\t\t\tconsole.log(\"exists  = \" + exists);\n\n\t\t\t\t\tif (!exists) {\n\n\t\t\t\t\t\tm_count++;\n\t\t\t\t\t\tif ($(\".new_post_buttons_container\").length > 0) {\n\t\t\t\t\t\t\t$(\".new_post_buttons_container\").after($(this).parent()[0].outerHTML);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t$(\"#new_post\").after($(this)[0].outerHTML);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t\t$(\"html, body\").animate({ scrollTop: 0 }, \"slow\");\n\t\t\t\tXKit.extensions.soft_refresh.do_post_ids();\n\n\t\t\t\tif (m_count === 0) {\n\t\t\t\t\tif (XKit.extensions.soft_refresh.preferences.show_notifications.value === true) {\n\t\t\t\t\t\tXKit.notifications.add(\"No new posts found.\",\"info\");\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tXKit.tools.add_function(soft_refresh_hit_triggers, true, \"\");\n\t\t\t\t\tXKit.extensions.soft_refresh.check_embeds();\n\t\t\t\t\tif (XKit.extensions.soft_refresh.preferences.show_notifications.value === true) {\n\t\t\t\t\t\tXKit.notifications.add(\"Added \" + m_count + \" new posts.\",\"ok\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tXKit.extensions.soft_refresh.loading = false;\n\t\t\t}\n\t\t});\n\n\t},\n\n\tcheck_embeds: function() {\n\n\t\tif ($(\"body\").find(\".inline_embed\").length > 0) {\n\t\t\t$(\"body\").find(\".inline_embed\").each(function() {\n\n\t\t\t\ttry {\n\t\t\t\t\tvar script = document.createElement(\"script\");\n\t\t\t\t\tscript.textContent = $(this).html();\n\t\t\t\t\tdocument.body.appendChild(script);\n\t\t\t\t\t$(this).remove();\n\t\t\t\t} catch(e) {\n\t\t\t\t\talert(e.message);\n\t\t\t\t}\n\n\t\t\t});\n\t\t}\n\n\t},\n\n\tshow_cant_load_error: function() {\n\n\t\tXKit.window.show(\"Can't get new posts\",\"I could not fetch the page requested. There might be a problem with Tumblr servers, please try again later, or click on the Refresh the Page button to refresh it manually.\",\"error\",\"<div class=\\\"xkit-button default\\\" id=\\\"xkit-close-message\\\">OK</div><a href=\\\"/dashboard/\\\" class=\\\"xkit-button\\\">Refresh the page</a>\");\n\n\t},\n\n\tdestroy: function() {\n\n\t\t$(\".logo_anchor\").attr('href', $(\".logo_anchor\").attr('data-old-href'));\n\t\t$(document).off(\"click\", \".logo_anchor\", XKit.extensions.soft_refresh.logo_clicked);\n\t\t$(\".logo_anchor\").attr('onclick','');\n\n\t\t$(\"#home_button a\").attr('href', $(\"#home_button a\").attr('data-old-href'));\n\t\t$(document).off(\"click\", \"#home_button\", XKit.extensions.soft_refresh.logo_clicked);\n\t\t$(\"#home_button\").attr('onclick','');\n\t\t$(\"#home_button\").children().attr('href',$(\"#home_button a\").attr('data-old-href'));\n\n\t\tXKit.tools.remove_css(\"soft_refresh\");\n\t\tthis.running = false;\n\t}\n\n});\n","file":"found","server":"up","errors":false,"icon":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MDJGQTAyRjlCN0UxMTFFMjk0QUZBNzNGNTRGREQ3QTQiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MDJGQTAyRkFCN0UxMTFFMjk0QUZBNzNGNTRGREQ3QTQiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowMkZBMDJGN0I3RTExMUUyOTRBRkE3M0Y1NEZERDdBNCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDowMkZBMDJGOEI3RTExMUUyOTRBRkE3M0Y1NEZERDdBNCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PtJDPYQAAAYCSURBVHjalFZbbBZF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","css":"#xkit_soft_refresh {\n\tbackground: rgba(0,0,0,0.10);\n\tborder: 1px solid rgba(0,0,0,0.22);\n\tborder-radius: 6px;\n\tcolor: rgba(255,255,255,0.64);\n\tpadding: 0px 20px;\n\tfont-size: 13px;\n\theight: 40px;\n\ttext-align: center;\n\tdisplay: none;\n\tmargin-top: 20px;\n\tline-height: 40px;\t\n}","title":"Soft Refresh","description":"Refresh without refreshing","developer":"STUDIOXENIX","version":"0.5.4","details":"This extension allows you to see new posts on your dashboard without refreshing the page. When you get the New Posts bubble, click on the Tumblr logo, and new posts will appear on your dashboard.<br><br>If you still want to refresh the page completely (perform a Hard Refresh), hold the ALT key while clicking on logo and the page will refresh.<br><br>Please note that this extension is highly experimental, and might not work properly all the time.","frame":"false","beta":"false","slow":"true"}